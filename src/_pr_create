#compdef pr_create

_pr_create() {
  typeset -A hosts
  hosts=(
    hulu     "github.prod.hulu.com"
    twdc     "github.twdcgrid.net"
    disney   "github.twdcgrid.net"
    bamgrid  "github.bamgrid.co"
  )
  
  # Generate host completion options
  local -a host_completions
  for key val in "${(@kv)hosts}"; do
    host_completions+=("$key:$val")
  done
  
  local -a args custom_opts
  custom_opts=(
    '(--title)--title=[Pull request title]:title:' 
    "(--host)--host=[GitHub host]:host:($host_completions)"
    '(-h --help)'{-h,--help}'[Show help information]'
  )
  
  # Define completion context with custom options
  _arguments -C \
    "${custom_opts[@]}" \
    '*:gh options:->gh_completion'
  
  # Delegate to _gh for remaining completions
  if [[ $state == gh_completion ]]; then
    # Set up command line as gh would expect
    words=(gh pr create ${words[@]:1})
    (( CURRENT += 2 ))
    _gh
  fi
}

if [ "$funcstack[1]" = "_pr_create" ]; then
    _pr_create "$@"
else
    compdef _pr_create pr_create
fi
